<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Invoice Management</title>
        <link rel="stylesheet" href="styles.css" />
    </head>
    <body>
        <div class="container">
            <h1>Invoice Management</h1>

            <!-- Danh sách hóa đơn -->
            <div id="invoice-list">
                <h2>Invoices</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer Name</th>
                            <th>Total Amount</th>
                            <th>Timestamp</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="invoice-table-body">
                        <!-- Nội dung sẽ được JavaScript thêm vào -->
                    </tbody>
                </table>
            </div>

            <!-- Chi tiết hóa đơn -->
            <div id="invoice-details">
                <h2>Invoice Details</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Book Title</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Total Price</th>
                        </tr>
                    </thead>
                    <tbody id="details-table-body">
                        <!-- Nội dung sẽ được JavaScript thêm vào -->
                    </tbody>
                </table>
            </div>
        </div>
        <script>
            // script.js

            // Lấy danh sách hóa đơn từ API
            async function fetchInvoices() {
                const response = await fetch("/invoices"); // URL API Flask
                const invoices = await response.json();

                const tableBody = document.getElementById("invoice-table-body");
                tableBody.innerHTML = ""; // Xóa nội dung cũ

                invoices.forEach((invoice) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
            <td>${invoice.orderID}</td>
            <td>${invoice.customer_first_name} ${invoice.customer_last_name}</td>
            <td>${invoice.total_amount}</td>
            <td>${invoice.timestamp}</td>
            <td><button onclick="fetchInvoiceDetails(${invoice.orderID})">View Details</button></td>
        `;
                    tableBody.appendChild(row);
                });
            }

            // Lấy chi tiết hóa đơn từ API
            async function fetchInvoiceDetails(orderID) {
                const response = await fetch(`/invoice/${orderID}`); // URL API Flask
                const details = await response.json();

                const detailsTableBody =
                    document.getElementById("details-table-body");
                detailsTableBody.innerHTML = ""; // Xóa nội dung cũ

                details.forEach((item) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
            <td>${item.book_title}</td>
            <td>${item.quantity}</td>
            <td>${item.Selling_Price}</td>
            <td>${item.total_price}</td>
        `;
                    detailsTableBody.appendChild(row);
                });

                // Hiển thị chi tiết hóa đơn
                document.getElementById("invoice-details").style.display =
                    "block";
            }

            // Gọi API khi tải trang
            document.addEventListener("DOMContentLoaded", fetchInvoices);
        </script>
    </body>
</html>
